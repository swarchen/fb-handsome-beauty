!function(){var e=angular.module("pttTrend",["ngRoute","nvd3"]);e.factory("search",["$http","$location",function(e,t){var r={keywords:{},result:{},linedata:[],options:{chart:{type:"cumulativeLineChart",height:450,margin:{top:20,right:20,bottom:60,left:65},x:function(e){return e[0]},y:function(e){return e[1]/100},average:function(e){return e.mean/100},color:d3.scale.category10().range(),duration:300,useInteractiveGuideline:!0,clipVoronoi:!1,xAxis:{axisLabel:"時間",tickFormat:function(e){return d3.time.format("%m/%d/%y")(new Date(e))},showMaxMin:!1,staggerLabels:!0},yAxis:{axisLabel:"趨勢",tickFormat:function(e){return d3.format(",.1%")(e)},axisLabelDistance:20}}}};return r.send=function(n){return e.get("/search/"+n).success(function(e){if(e.query!==n)t.path("/showcases"),r.result=e;else{t.path("/result");var a={key:e.query,values:[]},s=0;e.data[3].values.forEach(function(e,t,n){var o=e.x.slice(0,4),l=e.x.slice(4,6),c=e.x.slice(6,8),i=l+"/"+c+"/"+o,u=new Date(i).getTime(),h=e.y;u>=14509728e5&&a.values.push([u,h]),s++,s===n.length&&r.linedata.push(a)})}})},r.clear=function(){r.linedata=[],t.path("/")},r.showcases=function(){return e.get("/api/showcases").success(function(e){r.result=e})},r.keywords=function(){return e.get("/api/getkeyword").success(function(e){0===Object.keys(e).length?r.keywords={Item:{keywords:[{k:"還沒有新的關鍵字出來喔"}]}}:r.keywords=e})},r}]),e.controller("searchCtrl",["$scope","search",function(e,t){e.search=function(r){"string"==typeof r&&1==r.split("%20").length&&1==r.split(" ").length&&1==r.split(".").length&&"還沒有新的關鍵字出來喔"!=r?(e.searching=1,t.send(r.toLowerCase()),e.searchQ=""):e.wrong=1},e.options=t.options,e.keywords=t.keywords,e.data=t.linedata,e.clear=function(){t.clear(),e.data=[]}}]),e.controller("showCtrl",["$scope","search",function(e,t){e.options=t.options,e.data=t.linedata,e.toggletitle=t.result[0].query,e.toggledata=t.result[0].data,e.toggle=function(t){e.toggledata=t.data,e.toggletitle=t.query}}]),e.config(function(e){e.when("/",{templateUrl:"/partials/search.html",controller:"searchCtrl",resolve:{keywords:function(e){return e.keywords()}}}).when("/result",{templateUrl:"/partials/result.html",controller:"searchCtrl"}).when("/showcases",{templateUrl:"/partials/showcases.html",controller:"showCtrl",resolve:{showcases:function(e){return e.showcases()}}}).otherwise({redirectTo:"/"})})}();